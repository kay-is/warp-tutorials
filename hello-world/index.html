<!DOCTYPE html>

<meta charset="utf-8" />
<title>SmartWeave Hello World</title>

<h1>SmartWeave Hello World</h1>

<button id="connectButton">Load Contract State</button>
<pre id="contractStatePre"></pre>

<script type="module">
  import { WarpFactory } from "warp-contracts"

  // Codespaces forwards ports as sub-domain with default SSL port.
  const arweaveClient = new Arweave({
    protocol: "https",
    host: window.location.host.replace("8080", "8888"),
    port: 443,
  })

  document
    .getElementById("connectButton")
    .addEventListener("click", async () => {
      const contractId = await fetch("contract-id").then((r) => r.text())

      // forLocal ignores Arweave port and needs it explicitly
      const contract = await WarpFactory.forLocal(443, arweaveClient).contract(
        contractId
      )

      const { cachedValue } = await contract.readState()
      const contractStatePre = document.getElementById("contractStatePre")
      contractStatePre.innerText = JSON.stringify(cachedValue.state, null, 2)
    })
</script>
