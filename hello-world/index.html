<!DOCTYPE html>

<meta charset="utf-8" />
<title>SmartWeave Hello World</title>

<h1>SmartWeave Hello World</h1>

<button id="connectButton">Load Contract State</button>
<pre id="contractStatePre"></pre>

<script type="module">
  import { WarpFactory } from "warp-contracts"

  const arlocalConfig = {
    protocol: window.location.protocol.slice(0, 5),
    host: window.location.host.replace("8080", "8888"),
    port:
      window.location.host === "localhost"
        ? 8888
        : window.location.protocol == "https:"
        ? 443
        : 80,
  }

  document
    .getElementById("connectButton")
    .addEventListener("click", async () => {
      const contractId = await fetch("contract-id").then((r) => r.text())

      const contract = await WarpFactory.forLocal(
        arlocalConfig.port,
        new Arweave(arlocalConfig)
      ).contract(contractId)

      const { cachedValue } = await contract.readState()
      const contractStatePre = document.getElementById("contractStatePre")
      contractStatePre.innerText = JSON.stringify(cachedValue.state, null, 2)
    })
</script>
